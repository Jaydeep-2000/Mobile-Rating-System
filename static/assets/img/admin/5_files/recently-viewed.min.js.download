/**
 * Table of contents: 
 * recently_viewed.js
 * Generated: 2020-10-27 07:21:22
 */


/* Filename: recently_viewed.js */

(function(){"use strict";function serialize(obj){let str=Object.keys(obj).reduce(function(a,k){a.push(k+'='+encodeURIComponent(obj[k]));return a;},[]).join('&');return str;}
var __recent={config:{cacheTTL:0,production:true,api:'https://api.91mobiles.com/nm/api/product/{type}/recentlyViewed',onpageLoad:true,},init:function(){__console("1.init");var setRecent=__$('[data-set-recently-viwed="true"]');if(setRecent){__recent.setRecentlyViewed(setRecent.getAttribute("data-cat-id"),setRecent.getAttribute("data-pro-id"));}
var getRecent=__$('[data-get-recently-viwed="true"]');__recent.loader();if(getRecent){__console("2.Calling API-");var queryStr="";if(getRecent.getAttribute("data-cat-id")&&getRecent.getAttribute("data-pro-id")){queryStr=serialize({excludeId:getRecent.getAttribute("data-cat-id")+"-"+getRecent.getAttribute("data-pro-id")})}
if(getRecent.getAttribute("data-load-type")=="scroll"){__console("inside Scroll");window.addEventListener("scroll",function(){var elementTarget=getRecent;if(getRecent.getAttribute("data-load-status")!="loaded"&&window.scrollY>(elementTarget.offsetTop+elementTarget.offsetHeight-800)){getRecent.setAttribute("data-load-status","loaded");__recentAjax('GET',__recent.config.api.replace("{type}","get")+"?"+queryStr,{},__recent.getRecentlyViwed);}});}
else{__console("inside Init");__recentAjax('GET',__recent.config.api.replace("{type}","get")+"?"+queryStr,{},__recent.getRecentlyViwed);}}},setRecentlyViewed:function(catid,id){if(catid>0&&id>0){__console("setRecentlyViewed")
__recentAjax('GET',__recent.config.api.replace("{type}","set")+"?"+serialize({"catId":catid,"pId":id}),{},{});}
else{__console(catid,id,"catid,id is not valid")}},getRecentlyViwed:function(response){__console("4.createWidget");var recentlyData='';var item=__$('[data-get-recently-viwed="true"]');if(response.results&&response.results.products&&response.results.products.length){var products=response.results.products;response.results['imagePath']=function(){return this.mediumImageURL.replace("medium","small");}
__console("4.1.createWidget -response items");if(item&&__$('#recently-viwed-template')){recentlyData+=Mustache.render(__$('#recently-viwed-template').innerHTML,response.results);item.innerHTML=recentlyData;var event=document.createEvent('Event');event.initEvent('recentloaded',true,true);item.dispatchEvent(event);}else{__recent.hide(item);__console("Mission Aborted -Item not Found");}}else{__recent.hide(item)
__console("Mission Aborted -API Data not found");}},hide:function(data){data.style.display='none';},loader:function(){__console("3.1.Loader Store item");var item=__$('[data-get-recently-viwed="true"]');if(item){item.innerHTML='<div class="loader_div"><div class="loader"></div></div>';}},}
function __$(expr,con){return typeof expr==="string"?(con||document).querySelector(expr):expr||null;}
function __$$(expr,con){return slice.call((con||document).querySelectorAll(expr));}
function __console(x){if(x&&(!__recent.config.production)){console.log(x);}}
var __recentAjax=function(method,url,data,callback){__console("Init:XMLHttpRequest");var x=new XMLHttpRequest();url=url+(url.indexOf("?")>-1?"&":"?")+"source="+(__recentDevice.isWap()?"wap":"web");x.timeout=5000;x.open(method,url,true);x.setRequestHeader("source",(__recentDevice.isWap()?"wap":"web"));x.setRequestHeader("kivanon",__recentKeyPage.getHeaders());x.withCredentials=true;if(method=="POST")
x.setRequestHeader('Content-Type','application/x-www-form-urlencoded');x.onreadystatechange=function(){if(x.readyState===4){switch(x.status){case 200:__console("readyState-4->Status-"+x.status);if("function"===typeof callback){callback(JSON.parse(x.responseText.trim()));}
break;default:__console("readyState-4->Status-"+x.status);if("function"===typeof callback){callback(false);}
break;}}else if(x.readyState===2){__console("readyState-2");}else if(x.readyState===3){__console("readyState-3");}}
try{x.send(serialize(data));}catch(err){callback(false);console.log("API Error");}}
var __recentKeyPage={getHeaders:function(){var keyPage=dcodeIO.bcrypt;var pass=keyPage.genSaltSync(8);var tempPass=pass.substring(7,pass.length);var hash=keyPage.hashSync(tempPass,keyPage.genSaltSync(7));return"ST-cphk="+hash.substring(7,hash.length)+"&"+"ctsk="+tempPass;}}
var __recentDevice={isWap:function(){if(navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i)){return true;}
return false;}}
if(typeof Document!=="undefined"){if(__recent.config.onpageLoad){if(document.readyState!=="loading"){__console("0.1.document-loading");__recent.init();}else{__console("0.1.document-Wait for it ");document.addEventListener("DOMContentLoaded",__recent.init,false);}}else{document.addEventListener("scroll",__recent.init);}}}());;;